<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PokéGems Wiki</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="logo">
      <a href="/">
        <img src="images/logo.png" alt="PokeGems Logo" />
      </a>
    </div>
    <ul class="nav-links">
      <li><a href="pokemon.html">Pokémon</a></li>
      <li><a href="characters.html">Characters</a></li>
      <li><a href="misc.html">Misc.</a></li>
    </ul>
  </nav>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Search Bar -->
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search the wiki or newsfeed..." />
      <button id="searchButton">Search</button>
      <div id="searchResults" class="search-results"></div>
    </div>

    <!-- Action Buttons -->
    <div class="button-container">
      <a href="https://store.playpokegems.com" target="_blank" class="stylized-button">
        <i class="fas fa-shop"></i>
      </a>
      <a href="https://map.playpokegems.com" target="_blank" class="stylized-button">
        <i class="fas fa-compass"></i>
      </a>
      <a href="https://discord.gg/vdMc5yU3Tu" target="_blank" class="stylized-button">
        <i class="fa-brands fa-discord"></i>
      </a>
    </div>

    <!-- Newsfeed Section -->
    <div class="newsfeed-container">
      <h2>Latest News</h2>
      <div id="newsfeed"></div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 PokéGems. All rights reserved.</p>
  </footer>

  <!-- Font Awesome for Icons -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>

  <!-- Fetch Newsfeed -->
  <script>
    const searchInput = document.getElementById("searchInput");
    const searchButton = document.getElementById("searchButton");
    const searchResults = document.getElementById("searchResults");

    // Simulated list of pages
    const pages = [
      { name: "Pokémon", url: "pokemon.html" },
      { name: "Characters", url: "characters.html" },
      { name: "Misc.", url: "misc.html" },
    ];

    // Fetch the newsfeed from the server
    async function fetchNewsfeed() {
      try {
        const response = await fetch("/api/newsfeed");
        const posts = await response.json();
        const newsfeed = document.getElementById("newsfeed");

        newsfeed.innerHTML = ""; // Clear existing content
        posts.forEach((post) => {
          const newsItem = document.createElement("div");
          newsItem.classList.add("news-item");

          const title = document.createElement("h3");
          title.textContent = post.title;

          const content = document.createElement("p");
          content.textContent = post.content;

          newsItem.appendChild(title);
          newsItem.appendChild(content);

          if (post.media) {
            if (post.mediaType === "image") {
              const img = document.createElement("img");
              img.src = post.media;
              img.alt = "News Image";
              img.style.maxWidth = "100%";
              newsItem.appendChild(img);
            } else if (post.mediaType === "video") {
              const video = document.createElement("video");
              video.src = post.media;
              video.controls = true;
              video.style.maxWidth = "100%";
              newsItem.appendChild(video);
            }
          }

          newsfeed.appendChild(newsItem);
        });
      } catch (error) {
        console.error("Error fetching newsfeed:", error);
      }
    }

    // Dynamic search functionality
    searchInput.addEventListener("input", function () {
      const query = searchInput.value.toLowerCase().trim();
      searchResults.innerHTML = ""; // Clear previous results

      if (query === "") {
        searchResults.style.display = "none"; // Hide results if input is empty
        return;
      }

      // Combine pages and newsfeed items
      const results = [...pages];

      fetch("/api/newsfeed")
        .then((res) => res.json())
        .then((newsfeed) => {
          newsfeed.forEach((post) => {
            results.push({ name: post.title, url: "#" }); // Add news titles
          });

          const matches = results.filter((item) =>
            item.name.toLowerCase().includes(query)
          );

          if (matches.length > 0) {
            matches.forEach((match) => {
              const resultItem = document.createElement("div");
              resultItem.textContent = match.name;
              resultItem.classList.add("search-result-item");
              resultItem.onclick = () => {
                if (match.url !== "#") {
                  window.location.href = match.url;
                } else {
                  alert("Redirecting to news section is under development.");
                }
              };
              searchResults.appendChild(resultItem);
            });
          } else {
            const noResultItem = document.createElement("div");
            noResultItem.textContent = "No results found!";
            noResultItem.classList.add("search-result-item");
            searchResults.appendChild(noResultItem);
          }

          searchResults.style.display = "block"; // Show results
        });
    });

    // Hide results when clicking outside the search bar
    document.addEventListener("click", function (event) {
      if (!searchInput.contains(event.target) && !searchResults.contains(event.target)) {
        searchResults.style.display = "none";
      }
    });

    fetchNewsfeed(); // Load newsfeed on page load
  </script>
</body>
</html>
